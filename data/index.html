



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Taller de introducción a docker">
      
      
      
        <meta name="author" content="Sergio Gómez <sergio@uco.es>">
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/logoasl.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Persistiendo datos - Taller de Docker</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#persistiendo-datos" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Taller de Docker" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Taller de Docker
              </span>
              <span class="md-header-nav__topic">
                Persistiendo datos
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/aulasoftwarelibre/taller-de-docker.git/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      aulasoftwarelibre/taller-de-docker
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Taller de Docker" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Taller de Docker
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/aulasoftwarelibre/taller-de-docker.git/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      aulasoftwarelibre/taller-de-docker
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Inicio" class="md-nav__link">
      Inicio
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" title="Instalación" class="md-nav__link">
      Instalación
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crear-un-volumen" title="Crear un volumen" class="md-nav__link">
    Crear un volumen
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-nuestro-blog" title="Creando nuestro blog" class="md-nav__link">
    Creando nuestro blog
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aulasoftwarelibre/taller-de-docker.git/edit/master/docs/data.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="persistiendo-datos">Persistiendo datos<a class="headerlink" href="#persistiendo-datos" title="Permanent link">&para;</a></h1>
<p>Por defecto ya hemos indicado que un contenedor está aislado de todo. Hemos visto como podemos conectar el contenedor a un puerto de red para poder acceder a él. Eso incluye al sistema de archivos que contiene. De tal manera que si se elimina el contenedor, se eliminan también sus archivos.</p>
<p>Si queremos almacenar datos (una web, una base de datos, etc.) dentro de un contenedor necesitamos una manera de almacenarlos sin perderlos.</p>
<p>Docker ofrece tres maneras:</p>
<ul>
<li>A través de volúmenes, que son objetos de Docker como las imágenes y los contenedores.</li>
<li>Montando un directorio de la máquina anfitrión dentro del contenedor.</li>
<li>Almacenándolo en la memoria del sistema (aunque también se perderían al reiniciar el servidor).</li>
</ul>
<p>Lo normal es usar volúmenes, pero habrá ocasiones en que es preferible montar directamente un directorio de nuestro espacio de trabajo. Por ejemplo, para guardar los datos de una base de datos usaremos volúmenes, pero para guardar el código de una aplicación o de una página web montaremos el directorio.</p>
<p>La razón para esto último es que tanto nuestro entorno de desarrollo como el contenedor tengan acceso a los archivos del código fuente. Los volúmenes, al contrario que los directorios montados, no deben accederse desde la máquina anfitrión.</p>
<h2 id="crear-un-volumen">Crear un volumen<a class="headerlink" href="#crear-un-volumen" title="Permanent link">&para;</a></h2>
<p>Como necesitamos crear una base de datos para nuestro blog con <em>WordPress</em> vamos a crear un volumen donde guardar la información:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="hll"><span class="gp">$</span> docker volume create wordpress-db
</span><span class="go">wordpress-db</span>

<span class="hll"><span class="gp">$</span> docker volume ls
</span><span class="go">DRIVER              VOLUME NAME</span>
<span class="go">local               wordpress-db</span>

<span class="hll"><span class="gp">$</span> docker volume inspect wordpress-db 
</span><span class="go">[</span>
<span class="go">    {</span>
<span class="go">        &quot;CreatedAt&quot;: &quot;yyyy-mm-ddThh:ii:ss+Z&quot;,</span>
<span class="go">        &quot;Driver&quot;: &quot;local&quot;,</span>
<span class="go">        &quot;Labels&quot;: {},</span>
<span class="go">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/wordpress-db/_data&quot;,</span>
<span class="go">        &quot;Name&quot;: &quot;wordpress-db&quot;,</span>
<span class="go">        &quot;Options&quot;: {},</span>
<span class="go">        &quot;Scope&quot;: &quot;local&quot;</span>
<span class="go">    }</span>
<span class="go">]</span>
</pre></div>
</td></tr></table>

<p>En la línea 1 creamos el volumen. En la línea 4 comprobamos que está creado (pueden aparecer más). En la 8, con la orden inspect, podemos ver los metadatos del volumen y el lugar donde se almacena realmente.</p>
<p>Vamos a crear nuestra base de datos usando este volumen.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="hll"><span class="gp">$</span> docker run -d --name wordpress-db <span class="se">\</span>
</span><span class="hll">    --mount <span class="nv">source</span><span class="o">=</span>wordpress-db,target<span class="o">=</span>/var/lib/mysql <span class="se">\</span>
</span><span class="hll">    -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>secret <span class="se">\</span>
</span><span class="hll">    -e <span class="nv">MYSQL_DATABASE</span><span class="o">=</span>wordpress <span class="se">\</span>
</span><span class="hll">    -e <span class="nv">MYSQL_USER</span><span class="o">=</span>manager <span class="se">\</span>
</span><span class="hll">    -e <span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>secret mariadb:10.3.9
</span><span class="go">Unable to find image &#39;mariadb:10.3.9&#39; locally</span>
<span class="go">10.3.9: Pulling from library/mariadb</span>
<span class="go">124c757242f8: Pull complete </span>
<span class="go">9d866f8bde2a: Pull complete </span>
<span class="go">fa3f2f277e67: Pull complete </span>
<span class="go">398d32b153e8: Pull complete </span>
<span class="go">afde35469481: Pull complete </span>
<span class="go">31f2ae82b3e3: Pull complete </span>
<span class="go">3eeaf7e45ea6: Pull complete </span>
<span class="go">716982328e17: Pull complete </span>
<span class="go">34ce605c9036: Pull complete </span>
<span class="go">4502ed9073c0: Pull complete </span>
<span class="go">2afafbdf5a96: Pull complete </span>
<span class="go">43d52b11dd31: Pull complete </span>
<span class="go">30c7b70556f3: Pull complete </span>
<span class="go">8b1b39f2f89a: Pull complete </span>
<span class="go">41480b9319d7: Pull complete </span>
<span class="go">Digest: sha256:b7894bd08e5752acdd41fea654cb89467c99e67b8293975bb5d787b27e66ce1a</span>
<span class="go">Status: Downloaded newer image for mariadb:10.3.9</span>
<span class="go">30634831d17108aa553a5774e27f398760bdbdf32debc3179843e73aa5957956</span>

<span class="gp">$</span> docker ps
<span class="go">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span>
<span class="go">30634831d171        mariadb:10.3.9      &quot;docker-entrypoint.s…&quot;   20 seconds ago      Up 16 seconds       3306/tcp            wordpress-db</span>
</pre></div>
</td></tr></table>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Puedes copiar y pegar el comando desde la siguiente caja para ir más rápido</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker run -d --name wordpress-db \
--mount source=wordpress-db,target=/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=secret \
-e MYSQL_DATABASE=wordpress \
-e MYSQL_USER=manager \
-e MYSQL_PASSWORD=secret mariadb:10.3.9
</pre></div>
</td></tr></table>

</div>
<p>El principal cambio en <code>docker run</code> con respecto a la última vez es que no hemos usado
<code>-p</code> (el parámetro para publicar puertos) y hemos añadido el parámetro <code>-d</code>.</p>
<p>Lo primero que habremos notado es que el contenedor ya no se queda en primer plano. El parámetro <code>-d</code> indica que debe ejecutarse como un proceso en segundo plano. Así no podremos pararlo por accidente con <code>Control+C</code>.</p>
<p>Lo segundo es que vemos que el contenedor usa un puerto, el <code>3306/tcp</code>, pero no está linkado a la máquina anfitrión. No tenemos forma de acceder a la base de datos directamente. Nuestra intención es que solo el contenedor de <em>WordPress</em> pueda acceder.</p>
<p>Luego una serie de parámetros <code>-e</code> que nos permite configurar nuestra base de datos.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Los contenedores se configuran a través de variables de ambiente, que podemos configurar con el parámetro <code>-e</code> que vemos en la orden anterior. Gracias a ellos hemos creado una base de datos, un usuario y configurado las contraseñas.</p>
<p>Se recomienda buscar en el registro de <em>Docker</em> la imagen oficial de <a href="https://hub.docker.com/_/mariadb/">MariaDB</a> para entender el uso de los parámetros.</p>
</div>
<p>Por último, el parámetro <code>--mount</code> nos permite enlazar el volumen que creamos en el paso anterior con el directorio <code>/var/lib/mysql</code> del contenedor. Ese directorio es donde se guardan los datos de <em>MariaDB</em>. Eso significa que si borramos el contenedor, o actualizamos el contenedor a una nueva versión, no perderemos los datos porque ya no se encuentran en él, si no en el volumen. Solo lo perderíamos si borramos explícitamente el volumen.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Cada contendor que usemos tendrá uno o varios directorios donde se deben guardar los datos no volátiles. Nos corresponde a nosotros conocer la herramienta y saber de qué directorios se tratan. Usualmente están en la documentación del contenedor, pero no siempre.</p>
</div>
<h2 id="creando-nuestro-blog">Creando nuestro blog<a class="headerlink" href="#creando-nuestro-blog" title="Permanent link">&para;</a></h2>
<p>Vamos a crear otra vez nuestro contenedor de <em>WordPress</em>, pero esta vez vamos a conectarlo con nuestra base de datos. Además, queremos poder editar los ficheros de las plantillas, por si tenemos que modificar algo, así que necesitaremos montar el directorio del contenedor donde está instalado <em>WordPress</em> con nuestra cuenta de usuario en la máquina anfitrión.</p>
<p>Vamos a crear el espacio de trabajo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mkdir -p ~/Sites/wordpress/target &amp;&amp; cd ~/Sites/wordpress
</pre></div>
</td></tr></table>

<p>Y dentro de este directorio arrancamos el contenedor:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker run -d --name wordpress \
    --link wordpress-db:mysql \
    --mount type=bind,source=&quot;$(pwd)&quot;/target,target=/var/www/html \
    -e WORDPRESS_DB_USER=manager \
    -e WORDPRESS_DB_PASSWORD=secret \
    -p 8080:80 \
    wordpress:4.9.8
</pre></div>
</td></tr></table>

<p>Cuando termine la ejecución, si accedemos a la dirección <a href="http://localhost:8080/">http://localhost:8080/</a>, ahora sí podremos acabar el proceso de instalación de nuestro WordPress. Si listamos el directorio target comprobaremos que tenemos todos los archivos de instalación accesibles desde el directorio anfitrión.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/aulasoftwarelibre" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/aulasl" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://facebook.com/aulasl" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://instagram.com/aulasoftwarelibre" class="md-footer-social__link fa fa-instagram"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-51754922-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>