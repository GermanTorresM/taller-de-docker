



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Taller de introducción a docker">
      
      
      
        <meta name="author" content="Sergio Gómez <sergio@uco.es>">
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/logoasl.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Levantar un WordPress con Docker Compose - Taller de Docker</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#levantar-un-wordpress-con-docker-compose" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Taller de Docker" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Taller de Docker
              </span>
              <span class="md-header-nav__topic">
                Levantar un WordPress con Docker Compose
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/aulasoftwarelibre/taller-de-docker.git/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      aulasoftwarelibre/taller-de-docker
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Taller de Docker" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Taller de Docker
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/aulasoftwarelibre/taller-de-docker.git/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      aulasoftwarelibre/taller-de-docker
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Inicio" class="md-nav__link">
      Inicio
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../introduction/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" title="Instalación" class="md-nav__link">
      Instalación
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../images/" title="Imágenes" class="md-nav__link">
      Imágenes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../containers/" title="Contenedores" class="md-nav__link">
      Contenedores
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../data/" title="Persistiendo datos" class="md-nav__link">
      Persistiendo datos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../wordpress/" title="Levantar un WordPress con Docker" class="md-nav__link">
      Levantar un WordPress con Docker
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Levantar un WordPress con Docker Compose
      </label>
    
    <a href="./" title="Levantar un WordPress con Docker Compose" class="md-nav__link md-nav__link--active">
      Levantar un WordPress con Docker Compose
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker-compose" title="Docker Compose" class="md-nav__link">
    Docker Compose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-contenedores-automatizada" title="Creación de contenedores automatizada" class="md-nav__link">
    Creación de contenedores automatizada
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iniciar-servicios" title="Iniciar servicios" class="md-nav__link">
    Iniciar servicios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detener-servicios" title="Detener servicios" class="md-nav__link">
    Detener servicios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#borrar-servicios" title="Borrar servicios" class="md-nav__link">
    Borrar servicios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura-de-la-configuracion" title="Estructura de la configuración" class="md-nav__link">
    Estructura de la configuración
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../dockerfile/" title="Crear imágenes propias" class="md-nav__link">
      Crear imágenes propias
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tips/" title="Trucos" class="md-nav__link">
      Trucos
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker-compose" title="Docker Compose" class="md-nav__link">
    Docker Compose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-contenedores-automatizada" title="Creación de contenedores automatizada" class="md-nav__link">
    Creación de contenedores automatizada
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iniciar-servicios" title="Iniciar servicios" class="md-nav__link">
    Iniciar servicios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detener-servicios" title="Detener servicios" class="md-nav__link">
    Detener servicios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#borrar-servicios" title="Borrar servicios" class="md-nav__link">
    Borrar servicios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura-de-la-configuracion" title="Estructura de la configuración" class="md-nav__link">
    Estructura de la configuración
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aulasoftwarelibre/taller-de-docker.git/edit/master/docs/docker-compose.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="levantar-un-wordpress-con-docker-compose">Levantar un WordPress con Docker Compose<a class="headerlink" href="#levantar-un-wordpress-con-docker-compose" title="Permanent link">&para;</a></h1>
<p>El cliente de <em>Docker</em> es engorroso para crear contenedores, así como para crear el resto de objetos y vincularlos entre sí.</p>
<p>Para automatizar la creación, inicio y parada de un contenedor o un conjunto de ellos, <em>Docker</em> proporciona una herramiento llamada <em>Docker Compose</em>.</p>
<p>Para esta parte vamos a detener y borrar lo que hemos creado:</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Borra el trabajo actual:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker container stop wordpress wordpress-db
docker container rm wordpress wordpress-db
docker volume rm wordpress-db
</pre></div>
</td></tr></table>

</div>
<h2 id="docker-compose">Docker Compose<a class="headerlink" href="#docker-compose" title="Permanent link">&para;</a></h2>
<p><em>Compose</em> es una herramienta para definir y ejecutar aplicaciones multi-contenedor. Con un solo comando podremos crear e iniciar todos los servicios que necesitamos para nuestra aplicación.</p>
<p>Los casos de uso más habituales para docker-compose son:</p>
<ul>
<li>Entornos de desarrollo</li>
<li>Entornos de testeo automáticos (integración contínua)</li>
<li>Despliegue en host individuales (no clusters)</li>
</ul>
<p><em>Compose</em> tiene comandos para manejar todo el ciclo de vida de nuestra aplicación:</p>
<ul>
<li>Iniciar, detener y rehacer servicios.</li>
<li>Ver el estado de los servicios.</li>
<li>Visualizar los logs.</li>
<li>Ejecutar un comando en un servicio.</li>
</ul>
<h2 id="creacion-de-contenedores-automatizada">Creación de contenedores automatizada<a class="headerlink" href="#creacion-de-contenedores-automatizada" title="Permanent link">&para;</a></h2>
<p>En el mismo directorio donde estábamos en el paso anterior (<code>~/Sites/wordpress</code>), vamos a crear un fichero llamado <code>docker-compose.yaml</code> con el siguiente contenido:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="s">&#39;3&#39;</span>

<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mariadb:10.3.9</span>
        <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data:/var/lib/mysql</span>
        <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_ROOT_PASSWORD=secret</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE=wordpress</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_USER=manager</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD=secret</span>
    <span class="l l-Scalar l-Scalar-Plain">web</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">wordpress:4.9.8</span>
        <span class="l l-Scalar l-Scalar-Plain">depends_on</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
        <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./target:/var/www/html</span>
        <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">WORDPRESS_DB_USER=manager</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">WORDPRESS_DB_PASSWORD=secret</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">WORDPRESS_DB_HOST=db</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">8080:80</span>

<span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">data</span><span class="p p-Indicator">:</span>
</pre></div>
</td></tr></table>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>YAML es un lenguaje de serialización de datos diseñado para ser leído y escrito por personas. Se recomienda que sigas algún tutorial para entender su formato: <a href="https://learnxinyminutes.com/docs/es-es/yaml-es/">Aprende YAML en Y minutos</a>.</p>
</div>
<p>Los ficheros de <em>Compose</em> están divididos en tres secciones: <em>services</em>, <em>volumes</em> y <em>networks</em>; y deben indicar un número de versión. Nos permite realizar practicamente lo mismo que podemos hacer con el cliente de <em>docker</em>, pero de forma automática.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>En este taller no entramos en el apartado de <em>networks</em>.</p>
</div>
<p>Con este fichero podemos hacer lo mismo que hemos hecho en el capítulo anterior, pero con la ventaja de describir todos nuestros requisitos en un solo archivo.</p>
<h2 id="iniciar-servicios">Iniciar servicios<a class="headerlink" href="#iniciar-servicios" title="Permanent link">&para;</a></h2>
<p>Vamos a ejecutar esta aplicación y luego procederemos a explicarla:</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Arranca la aplicación con <em>Compose</em>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker-compose up -d
</pre></div>
</td></tr></table>

</div>
<p>Cuando arrancamos la aplicación, <em>Compose</em> nos informa de los servicios que ha ido levantando:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ docker-compose up -d
Creating network &quot;wordpress_default&quot; with the default driver
Creating volume &quot;wordpress_data&quot; with local driver
Creating wordpress_db_1 ... 
Creating wordpress_db_1 ... done
Creating wordpress_web_1 ... 
Creating wordpress_web_1 ... done
</pre></div>
</td></tr></table>

<p>El parámetro <code>-d</code> es similar al que hemos visto en <code>docker run</code>: nos permite levantar los servicios en segundo plano.</p>
<p>Veamos los contenedores activos:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ docker container ls
CONTAINER ID  IMAGE            COMMAND      CREATED         STATUS         PORTS                  NAMES
a07b5d4d3982  wordpress:4.9.8  &quot;docker.s…&quot;  10 seconds ago  Up 8 seconds   0.0.0.0:8080-&gt;80/tcp   wordpress_web_1
d9204884cec5  mariadb:10.3.9   &quot;docker.s…&quot;  11 seconds ago  Up 10 seconds  3306/tcp               wordpress_db_1
</pre></div>
</td></tr></table>

<p>También podemos ver los contenedores con <em>Compose</em>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ docker-compose ps
    Name                    Command               State          Ports        
-------------------------------------------------------------------------------
wordpress_db_1    docker-entrypoint.sh mysqld      Up      3306/tcp            
wordpress_web_1   docker-entrypoint.sh apach ...   Up      0.0.0.0:8080-&gt;80/tcp
</pre></div>
</td></tr></table>

<p>Lo que tenemos que tener en cuenta es lo siguiente:</p>
<ul>
<li><code>docker-compose ps</code> solo muestra información de los servicios que se define en <code>docker-compose.yaml</code>, mientras que <code>docker</code> muestra todos.</li>
<li>Cuando creamos contenedores con <code>docker</code> sin indicar un nombre, por defecto asigna uno aleatorio; mientras que en <em>Compose</em> el prefijo es el nombre del directorio y el sufijo el nombre del servicio: <em><strong>wordpress</strong>_<strong>db</strong>_1</em>. El número indica el número de instancia. Es posible levantar más de una instancia de un mismo servicio.</li>
</ul>
<p>Si accedemos a la dirección <a href="http://localhost:8080/">http://localhost:8080/</a>, veremos de nuevo la instalación de WordPress.</p>
<h2 id="detener-servicios">Detener servicios<a class="headerlink" href="#detener-servicios" title="Permanent link">&para;</a></h2>
<p>Podemos detener servicios con</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker-compose stop
</pre></div>
</td></tr></table>

<h2 id="borrar-servicios">Borrar servicios<a class="headerlink" href="#borrar-servicios" title="Permanent link">&para;</a></h2>
<p>Podemos borrar servicios con</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker-compose down
</pre></div>
</td></tr></table>

<p>Esto borra los contenedores, pero no los volúmenes. Así que si hemos creado bien la aplicación nuestros datos están a salvo.</p>
<p>Si queremos borrar también los volúmenes:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker-compose down -v
</pre></div>
</td></tr></table>

<h2 id="estructura-de-la-configuracion">Estructura de la configuración<a class="headerlink" href="#estructura-de-la-configuracion" title="Permanent link">&para;</a></h2>
<p>Veamos la configuración por partes:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="hll"><span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="s">&#39;3&#39;</span>
</span></pre></div>
</td></tr></table>

<p><em>Compose</em> se actualiza a menudo, con lo que el archivo de configuración va adquiriendo nuevas funcionalidades. La versión '3' (es una cadena, importante poner comillas) es la última y para conocer todas sus características mira la <a href="https://docs.docker.com/compose/compose-file/">página de referencia de la versión 3 de Compose</a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="hll"><span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
</span>    <span class="l l-Scalar l-Scalar-Plain">data</span><span class="p p-Indicator">:</span>
</pre></div>
</td></tr></table>

<p>Ya hemos indicado que es importante guardar los datos volátiles de las aplicaciones en volúmenes. En este caso hemos creado un volumen llamado <code>data</code>. Recordemos que <em>Compose</em> siempre añade como prefijo el nombre del directorio, con lo que el nombre real del volumen es <code>wordpress_data</code>. Podemos comprobarlo con el cliente de docker como hicimos en el capítulo de volúmenes:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ docker volume ls
DRIVER              VOLUME NAME
local               wordpress_data
</pre></div>
</td></tr></table>

<p>Nos saltamos la sección de redes (<em>networks</em>) y vamos a la sección de servicios, que son los contenedores que precisa o componen nuestra aplicación.</p>
<p>Primero la base de datos:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
<span class="hll">    <span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
</span>        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mariadb:10.3.9</span>
        <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data:/var/lib/mysql</span>
        <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_ROOT_PASSWORD=secret</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE=wordpress</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_USER=manager</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD=secret</span>
</pre></div>
</td></tr></table>

<p>Después de abrir la parte de servicios, el primer nivel indica el nombre del servicio <code>db</code>, que genera el contenedor <code>wordpress_db</code>. Lo que vemos a continuación es lo mismo que hicimos en la sección anterior pero de forma parametrizada. Si recordamos, para levantar nuestra base de datos, indicamos la imagen (línea 3), luego montamos los volúmenes (línea 4), y después indicamos las variables de entorno que configuraban el contenedor (línea 6).</p>
<p>Es decir, lo anterior es equivalente, excepto por el nombre, a:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ docker run -d --name wordpress-db \
        --mount source=wordpress-db,target=/var/lib/mysql \
        -e MYSQL_ROOT_PASSWORD=secret \
        -e MYSQL_DATABASE=wordpress \
        -e MYSQL_USER=manager \
        -e MYSQL_PASSWORD=secret mariadb:10.3.9
</pre></div>
</td></tr></table>

<p>Y después nuestro <em>WordPress</em>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">web</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">wordpress:4.9.8</span>
        <span class="l l-Scalar l-Scalar-Plain">depends_on</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
        <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./target:/var/www/html</span>
        <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">WORDPRESS_DB_USER=manager</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">WORDPRESS_DB_PASSWORD=secret</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">WORDPRESS_DB_HOST=db</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">8080:80</span>
</pre></div>
</td></tr></table>

<p>En este caso la equivalencia es al comando:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ docker run -d --name wordpress \
    --link wordpress-db:mysql \
    --mount type=bind,source=&quot;$(pwd)&quot;/target,target=/var/www/html \
    -e WORDPRESS_DB_USER=manager \
    -e WORDPRESS_DB_PASSWORD=secret \
    -p 8080:80 \
    wordpress:4.9.8
</pre></div>
</td></tr></table>

<p>La equivalencia de los parámetros es la siguiente:</p>
<table>
<thead>
<tr>
<th>parámetro <em>Docker</em></th>
<th>parámetro <em>Composer</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>--link</td>
<td>depends_on</td>
</tr>
<tr>
<td>--mount</td>
<td>volumes</td>
</tr>
<tr>
<td>-e</td>
<td>environment</td>
</tr>
<tr>
<td>-p,--publish</td>
<td>ports</td>
</tr>
<tr>
<td></td>
<td>image</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si reiniciamos el ordenador, los contenedores estarán detenidos (stop), podremos reiniciarlos con <code>docker start</code> o <code>docker-compose start</code>. Este es el comportamiento predeterminado y el que nos interesa en un entorno de desarrollo.</p>
<p>Sin embargo, en otros entornos, o para casos concretos, igual queremos que un contenedor tenga el mismo estado en el que estaba antes de reiniciar la máquina (iniciado o parado).</p>
<p>Para eso usaremos el parámetro <code>restart</code>. En el caso de la base de datos de nuestro ejemplo, la configuración quedaría como:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mariadb:10.3.9</span>
<span class="hll">        <span class="l l-Scalar l-Scalar-Plain">restart</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span>        <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data:/var/lib/mysql</span>
        <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_ROOT_PASSWORD=secret</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE=wordpress</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_USER=manager</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD=secret</span>
</pre></div>
</td></tr></table>

<p>El equivalente en la consola sería:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="gp">$</span> docker run -d --name wordpress-db <span class="se">\</span>
<span class="hll">    --restart unless-stopped
</span><span class="go">    --mount source=wordpress-db,target=/var/lib/mysql \</span>
<span class="go">    -e MYSQL_ROOT_PASSWORD=secret \</span>
<span class="go">    -e MYSQL_DATABASE=wordpress \</span>
<span class="go">    -e MYSQL_USER=manager \</span>
<span class="go">    -e MYSQL_PASSWORD=secret mariadb:10.3.9</span>
</pre></div>
</td></tr></table>

<p>Otros valores son: <code>no</code> (por defecto), <code>always</code> y <code>on-failure</code>.</p>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../wordpress/" title="Levantar un WordPress con Docker" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Levantar un WordPress con Docker
              </span>
            </div>
          </a>
        
        
          <a href="../dockerfile/" title="Crear imágenes propias" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                Crear imágenes propias
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/aulasoftwarelibre" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/aulasl" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://facebook.com/aulasl" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://instagram.com/aulasoftwarelibre" class="md-footer-social__link fa fa-instagram"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-51754922-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>